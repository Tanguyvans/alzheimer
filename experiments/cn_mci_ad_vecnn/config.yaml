# Configuration for CN vs MCI vs AD with VECNN Model (3-Class Classification)
#
# Based on: "Vision transformer-equipped Convolutional Neural Networks for
# automated Alzheimer's disease diagnosis using 3D MRI scans"
# PMC11682981 (November 2024)
#
# Key improvements over 3D HCCT:
# - Subject-level splitting (no data leakage)
# - 92.14% accuracy reported with proper methodology
# - Batch size 16 (vs 3 in HCCT)
# - 150 epochs (vs 100 in HCCT)
# - 8:1:1 split ratio (80/10/10)
#
# Usage:
#   Step 1: python 01_prepare_dataset.py --config config.yaml
#   Step 2: python train.py --config config.yaml

# =============================================================================
# DATA PATHS - Edit these for your setup
# =============================================================================
data:
  # Input data (skull-stripped MRI scans from ADNI_skull)
  dxsum_csv: "/Volumes/KINGSTON/dxsum.csv"
  skull_dir: "/Volumes/KINGSTON/ADNI-skull"  # Skull-stripped, registered MRI scans

  # Output paths (relative to this experiment folder)
  splits_dir: "data/splits"          # Where to save train/val/test CSVs
  checkpoints_dir: "data/checkpoints" # Where to save model checkpoints
  logs_dir: "data/logs"               # TensorBoard logs
  results_dir: "data/results"         # Evaluation results

  # Automatically generated paths (don't edit)
  train_csv: "data/splits/train.csv"
  val_csv: "data/splits/val.csv"
  test_csv: "data/splits/test.csv"

# =============================================================================
# DATASET PREPARATION (Step 1)
# =============================================================================
dataset_preparation:
  train_ratio: 0.8                   # 80% training (from VECNN paper)
  val_ratio: 0.1                     # 10% validation
  test_ratio: 0.1                    # 10% test
  random_seed: 42

# =============================================================================
# MODEL ARCHITECTURE - VECNN
# =============================================================================
model:
  name: "VECNN"

  # Image/volume configuration
  image_size: 192              # Input volume size (192x192x192)
  num_channels: 1              # Number of input channels (grayscale MRI)
  num_classes: 3               # 3-class classification (CN vs MCI vs AD)

  # ResNet-50 backbone configuration
  block_distribution: [3, 3, 9, 3]  # Modified from [3,4,6,3] to align with Swin Transformer
  stem_kernel_size: 4          # Non-overlapping stem (4x4x4)
  stem_stride: 4               # Stride 4 for stem
  use_spatial_separable: true  # Use spatial separable convolutions
  activation: "gelu"           # GELU instead of ReLU

# =============================================================================
# TRAINING HYPERPARAMETERS (from VECNN paper)
# =============================================================================
training:
  batch_size: 16               # Batch size (from VECNN paper, increased from 3)
  epochs: 150                  # Maximum number of epochs (from VECNN paper)
  learning_rate: 0.0001        # Initial learning rate (1e-4, AdamW)
  weight_decay: 0.0001         # Weight decay for AdamW (1e-4)
  optimizer: "AdamW"           # Optimizer

  # Learning rate scheduler
  scheduler: "CosineAnnealing"  # Cosine annealing LR scheduler
  lr_warmup_epochs: 10         # Warmup for first 10 epochs
  lr_min: 0.00001              # Minimum learning rate (1e-5)

  # Class balancing
  use_weighted_loss: true      # Use weighted cross-entropy for class imbalance
  use_weighted_sampling: false # Use weighted random sampler

  # Reproducibility
  seed: 42                     # Random seed

# =============================================================================
# DATA AUGMENTATION
# =============================================================================
augmentation:
  enabled: true                # Enable data augmentation
  random_flip_prob: 0.5        # Probability of random flip
  random_rotation_degrees: 15  # Max rotation degrees
  random_affine: true          # Apply random affine transforms
  elastic_deformation: false   # Apply elastic deformation (expensive)
  intensity_shift: true        # Random intensity shifts
  intensity_scale: true        # Random intensity scaling

# =============================================================================
# HARDWARE & PERFORMANCE
# =============================================================================
hardware:
  device: "cuda"               # cuda or cpu
  num_workers: 4               # Number of dataloader workers
  pin_memory: true             # Pin memory for faster GPU transfer
  mixed_precision: true        # Use automatic mixed precision (FP16) for speed

# =============================================================================
# CALLBACKS & MONITORING
# =============================================================================
callbacks:
  early_stopping:
    enabled: true
    patience: 20               # Stop if no improvement after 20 epochs
    monitor: "val_accuracy"    # Metric to monitor
    mode: "max"                # Maximize accuracy

  checkpoint:
    save_top_k: 3              # Save top 3 checkpoints
    monitor: "val_accuracy"    # Metric to monitor for best checkpoint
    mode: "max"                # Maximize
    save_last: true            # Always save last checkpoint

  logging:
    log_every_n_steps: 10      # Log metrics every N steps
    save_training_plot: true   # Save training curves

# =============================================================================
# WEIGHTS & BIASES (WANDB) LOGGING
# =============================================================================
wandb:
  enabled: true                # Enable/disable wandb logging
  project: "alzheimer-research"
  entity: null                 # Wandb entity/team name (null = use default)
  run_name: "cn-mci-ad-vecnn"  # Custom run name
  log_model: false             # Upload model checkpoints to wandb
  tags:
    - vecnn
    - vision-transformer
    - resnet50
    - 3-class-classification
    - cn-mci-ad
    - patient-level-split
  notes: "VECNN for 3-class classification: CN vs MCI vs AD (stable patients, patient-level split)"

# =============================================================================
# EVALUATION
# =============================================================================
evaluation:
  metrics:
    - accuracy
    - balanced_accuracy
    - precision
    - recall
    - f1
    - auc
    - confusion_matrix

  save_predictions: true       # Save predictions on test set
  save_attention_maps: false   # Save attention visualizations
